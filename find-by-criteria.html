<html>
	<head>
		<title>Find Best Fit</title>
		<link rel="stylesheet" href="searchDisplay.css"/>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192"  href="icons/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
		<link rel="manifest" href="icons/manifest.json">
		<meta name="msapplication-TileColor" content="#ffffff">
		<meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
		<meta name="theme-color" content="#ffffff">
		
		<link href="https://fonts.googleapis.com/css?family=Francois%20One" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Play" rel="stylesheet">
	</head>
	<body>
		<span id="loader">
			<span id="lr1"></span>
			<span id="lr2"></span>
			<span id="lr3"></span>
		</span>
		<h1 id="errElm" style="top:50%;text-align:center;color:#feffed;position:fixed;width:100%;text-shadow:black 1px 1px 2px;">Sorry, no results...</h1>
		<div class="topnav">
			<img src="logo_notext.png" width="36" style="margin: 2px;"/><span><button onclick="window.location.href='index.html';">Search Colleges</button><button class="selected" onclick="resetPage()">Find Best Fit</button><button onclick="window.location.href='sat-act-prep';">SAT/ACT Prep</button></span>
		</div>
		<div class="search-bar" style="display: none;">
			<input id="search-box" type="search" placeholder="Search for Universities..."/>
		</div>
		<div id="search-options" class="flex">
			<div>
			<span class="label">SAT Score</span><br/>
				<span id="i1">From <input type="number"/> to <input type="number"/></span>
			</div>
			<div>
			<span class="label">ACT Score</span><br/>
				<span id="i2">From <input type="number"/> to <input type="number"/></span>
			</div>
			<div>
			<span class="label">Graduates&rsquo; Salary</span><br/>
				<span id="i3">From <input type="number"/> to <input type="number"/></span>
			</div>
			<div>
			<span class="label">Acceptance Rate (%)</span><br/>
				<span id="i4">From <input type="number"/> to <input type="number"/></span>
			</div>
			<div>
			<span class="label">Tuition Cost</span><br/>
				<span id="i5">From <input type="number"/> to <input type="number"/></span>
			</div>
			<div>
			<span class="label">Graduation Rate (%)</span><br/>
				<span id="i6">From <input type="number"/> to <input type="number"/></span>
			</div>
			<div>
			<span class="label">Subject Interest</span><br/>
				<span id="i7">Select an Interest: <select>
					<option>Select...</option>
					<option>Agriculture</option>
					<option>Resources</option>
					<option>Architecture</option>
					<option>Ethnic Cultural Gender</option>
					<option>Communication</option>
					<option>Communications Technology</option>
					<option>Computer</option>
					<option>Personal Culinary</option>
					<option>Education</option>
					<option>Engineering</option>
					<option>Engineering Technology</option>
					<option>Language</option>
					<option>Family Consumer Science</option>
					<option>Legal</option>
					<option>English</option>
					<option>Humanities</option>
					<option>Library</option>
					<option>Biological</option>
					<option>Mathematics</option>
					<option>Military</option>
					<option>Multidiscipline</option>
					<option>Parks Recreation Fitness</option>
					<option>Philosophy Religious</option>
					<option>Theology Religious Vocation</option>
					<option>Physical Science</option>
					<option>Science Technology</option>
					<option>Psychology</option>
					<option>Security Law Enforcement</option>
					<option>Public Administration Social Service</option>
					<option>Social Science</option>
					<option>Construction</option>
					<option>Mechanic Repair Technology</option>
					<option>Precision Production</option>
					<option>Transportation</option>
					<option>Visual Performing</option>
					<option>Health</option>
					<option>Business Marketing</option>
					<option>History</option>
				</select></span>
			</div>
			<div>
				<span>
					<span class="label">Sort Results</span>
					<span id="i8"><select id="sort-drop">
						<option>Default</option>
						<option>SAT Score</option>
						<option>ACT Score</option>
						<option>Salary of Graduates</option>
						<option>Acceptance Rate</option>
						<option>Programs of Interest</option>
						<option>Tuition Cost</option>
					</select></span>
				</span>
				<br/>
				<span>
					<input id="sort-asc" type="radio" name="sort"/><label nofont for="sort-asc"><i class="fa fa-sort-numeric-asc"></i> Ascending</label>
					<input id="sort-des" type="radio" name="sort"/><label nofont for="sort-des"><i class="fa fa-sort-numeric-desc"></i> Descending</label><br/>
				</span>
			</div>
		</div>
		<div id="btn-container" style="position: relative; top: 64px; display: block; margin: auto; text-align: center;">
			<button onclick="searchByFilters()" id="filtered-search-btn"><b>Search</b></button>
		</div>
		<div style="display:none;" class="result-container"></div>
		<div class="more-info"></div>
	</body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="main.js"></script>
	<script src="searchColleges.js"></script>
	<script>
		function resetPage() {
			if (busy) return;
			document.querySelectorAll('.result-container *').forEach((e)=>(e.remove()));
			document.querySelector('.result-container').style.display = "none";
			document.getElementById('search-options').style.display = "";
			document.getElementById('btn-container').style.display = "";
			hasResults = false;
			page = 0;
			stopAnimate();
			errElm.style.display = "none";
		}
		
		function searchByFilters() {
			document.getElementById('search-options').style.display = 'none';
			document.getElementById('btn-container').style.display = 'none';
			document.querySelector('.result-container').style = "";
			if (busy) return;
			page = 0;
			busy = true;
			$('.school-card').remove();
			startAnimate();
			
			var vals = document.querySelectorAll('.flex input[type=number]');
			
			var sortDropdownValue = document.getElementById('sort-drop').value;
			
			var selectVal = document.getElementById('i7').querySelector('select').value;
			var sortTerms = {
				"SAT Score": "latest.admissions.sat_scores.average.overall",
				"ACT Score": "latest.admissions.act_scores.midpoint.cumulative",
				"Salary of Graduates": "latest.earnings.10_yrs_after_entry.median",
				"Acceptance Rate": "latest.admissions.admission_rate.overall",
				"Tuition Cost": "latest.cost.tuition.out_of_state",
				"Default": "latest.earnings.10_yrs_after_entry.median",
				"Programs of Interest": ((selectVal != "Select...") ? "latest.academics.program_percentage." + selectVal.replace(/\s/g,'_').toLowerCase() : 'latest.earnings.10_yrs_after_entry.median')
			}
			
			req_url = `https://api.data.gov/ed/collegescorecard/v1/schools.json?api_key=j7wcTx0TdVV4gl93JobRFSOspmmLOtdxO5gg0AeK&sort=${sortTerms[sortDropdownValue]}:${(document.getElementById('sort-asc').checked) ? 'asc' : 'desc'}
				&page=0
				&latest.admissions.sat_scores.average.overall__range=${vals[0].value||0}..${vals[1].value||''}
				&latest.admissions.act_scores.midpoint.cumulative__range=${vals[2].value||0}..${vals[3].value||''}
				&latest.earnings.10_yrs_after_entry.median__range=${vals[4].value||0}..${vals[5].value||''}
				&latest.admissions.admission_rate.overall__range=${Number(vals[6].value)/100||0}..${Number(vals[7].value)/100||''}
				&latest.cost.tuition.out_of_state__range=${vals[8].value||0}..${vals[9].value||''}
				&latest.completion.completion_rate_4yr_100nt__range=${Number(vals[10].value)/100||0}..${Number(vals[11].value)/100||''}
				${(selectVal != "Select...") ? '&latest.academics.program_percentage.' + selectVal.replace(/\s/g,'_').toLowerCase() + '__range=0.05..' : ''}
				
				&fields=
					id,
					school.name,
					school.city,
					school.state,
					school.zip,
					school.school_url,
					school.price_calculator_url,
					latest.student.size,
					latest.student.enrollment.all,
					latest.student.demographics.race_ethnicity,
					latest.cost.avg_net_price,
					latest.cost.tuition,
					latest.admissions,
					latest.admissions.admission_rate.overall,
					latest.completion.completion_rate_4yr_100nt,
					latest.earnings.10_yrs_after_entry.median,
					latest.academics.program_percentage,
					school.accreditor_code
				`;
			request(req_url.replace(/\s\n/g,''), function (result) {
					var collegeList = JSON.parse(result);
					
					console.log(collegeList);
					console.log(JSON.stringify(collegeList));
					
					if (collegeList.results.length == 0) {
						stopAnimate();
						errElm.style.display = "";
						busy = false;
						return;
					}
					
					collegeList.results.forEach(function(c) {
						console.log(c['school.name'] + '\n' +  c['school.school_url'] + '\n' + c['latest.admissions.']);
						showCard(c);
					});
				});page ++;
			}
	</script>
</html>
